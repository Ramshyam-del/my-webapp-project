<!DOCTYPE html>
<html>
<head>
    <title>Debug Session</title>
</head>
<body>
    <h1>Session Debug</h1>
    <div id="output"></div>
    
    <script type="module">
        import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js@2';
        
        const supabaseUrl = 'https://wnqvqfqjqhqjqhqjqhqj.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InducXZxZnFqcWhxanFocWpxaHFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5NzU2NzEsImV4cCI6MjA3MjU1MTY3MX0.example';
        
        async function debugSession() {
            const output = document.getElementById('output');
            
            // Check localStorage
            const localStorageKeys = Object.keys(localStorage);
            output.innerHTML += '<h2>LocalStorage:</h2>';
            localStorageKeys.forEach(key => {
                if (key.includes('supabase') || key.includes('sb-')) {
                    output.innerHTML += `<p><strong>${key}:</strong> ${localStorage.getItem(key)?.substring(0, 100)}...</p>`;
                }
            });
            
            // Check cookies
            output.innerHTML += '<h2>Cookies:</h2>';
            const cookies = document.cookie.split(';');
            cookies.forEach(cookie => {
                if (cookie.includes('sb-')) {
                    output.innerHTML += `<p>${cookie.trim()}</p>`;
                }
            });
            
            // Check session storage
            output.innerHTML += '<h2>SessionStorage:</h2>';
            const sessionStorageKeys = Object.keys(sessionStorage);
            sessionStorageKeys.forEach(key => {
                if (key.includes('supabase') || key.includes('sb-')) {
                    output.innerHTML += `<p><strong>${key}:</strong> ${sessionStorage.getItem(key)?.substring(0, 100)}...</p>`;
                }
            });
            
            // Try to get current session
            try {
                const response = await fetch('/api/admin/me', {
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                output.innerHTML += '<h2>API Test:</h2>';
                output.innerHTML += `<p><strong>Status:</strong> ${response.status}</p>`;
                
                if (response.ok) {
                    const data = await response.json();
                    output.innerHTML += `<p><strong>Response:</strong> ${JSON.stringify(data, null, 2)}</p>`;
                } else {
                    const errorText = await response.text();
                    output.innerHTML += `<p><strong>Error:</strong> ${errorText}</p>`;
                }
            } catch (error) {
                output.innerHTML += `<p><strong>Fetch Error:</strong> ${error.message}</p>`;
            }
        }
        
        debugSession();
    </script>
</body>
</html>